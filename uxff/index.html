<!DOCTYPE html 
      PUBLIC "-//W3C//DTD HTML 4.01//EN"
      "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-US">
<head profile="http://www.w3.org/2005/10/profile">
<link rel="icon" 
      type="image/png" 
      href="https://ke0ff.github.io/index_files/fav_i_con.PNG">

<!-- saved from url=(0039)http://www.rollanet.org/~joeh/projects/ -->
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="ProgId" content="Word.Document">
<meta name="Generator" content="Microsoft Word 11">
<meta name="Originator" content="Microsoft Word 11">
<link rel="File-List" href="./index_files/filelist.xml">
<link rel="Edit-Time-Data" href="./index_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title align="CENTER">The ICOM UX FFront Unit Page</title>
<meta name="description" content="Circuit theory, software theory of operation, assembly, and operation of the UX FFront Unit, an alternate PCB for the ICOM IC-900 band modules, designed by Joe Haas, KE0FF.">
<meta name="keywords" content="IC-900,IC-901,UX-19,UX-29,UX-39,UX-49,UX-59,UX-129,ICOM,C8051F530,Stand-alone receiver">
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>J</o:Author>
  <o:LastAuthor>J</o:LastAuthor>
  <o:Revision>7</o:Revision>
  <o:TotalTime>5</o:TotalTime>
  <o:Created>2012-12-20T18:22:00Z</o:Created>
  <o:LastSaved>2012-12-20T22:32:00Z</o:LastSaved>
  <o:Pages>2</o:Pages>
  <o:Words>475</o:Words>
  <o:Characters>2714</o:Characters>
  <o:Company> DACINT</o:Company>
  <o:Lines>22</o:Lines>
  <o:Paragraphs>6</o:Paragraphs>
  <o:CharactersWithSpaces>3183</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:14.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:14.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:14.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:1021979350;
	mso-list-template-ids:450297508;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:14.0pt;
	font-family:Symbol;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--></head><body bgcolor="white" background="../index_files/ffback.JPG" lang="EN-US" link="blue" vlink="blue" style="tab-interval:.5in"><header></header><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="5122"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->




<div class="Section1">

<div class="MsoNormal" align="center" style="text-align:center">

<hr size="2" width="100%" align="center">

</div>

<div class="MsoNormal" align="center" >

<h2 align="center" style="text-align:center">ICOM UX FFront Module Project Page</h2>

<p class="MsoNormal">Updated 11/23/2019 </p>
<a href="../index.html">(Back to the Projects page...)</a>

<hr size="2" width="100%" align="center">

</div>

<!--<p class="MsoNormal" align="center" style="text-align:center"><img width="483" height="839" id="_x0000_i1026" src="./hm133_banner.jpg"> -->
<center>
<font size = "6">
This page presents the UX FFront Unit Project design description</p>
<font size = "4">

<img width="1447" height="169" src="./uxff_banner.png">
</p>
<table border="0" width="950">
<tr>
<!--
<td>
<img width="483" height="878" id="_x0000_i1026" src="./uxff_banner.jpg">
</td>
<td>
<img width="40" height="20" id="_x0000_i1026" src="./space40.png">
</td>
-->
<td>

The UX FFront Unit is an alternate design-spin on the original UX Front Unit used by the <a href="http://www.icom.co.jp/world/support/download/manual/pdf/IC-900A_E.pdf">ICOM IC-900</a> UX band modules.
It acts as a form-fit-function replacement for the orignal PCB Assembly (PCBA), in the case where the original board is lost or
damaged beyond repair.  However, with alternate software and assembly components, the module can perform some interesting
tasks.  One of which is to act as an interposer, whereby the module presents to the IC900/901 as one band, but the
on-board microcontroller (MCU) translates the base-controller's frequency commands to the module's frequency space.  Ostensibly,
This would allow a module of one type to connect to a transverter, and seamlessly appear to operate on the antenna frequency of the
transverter.  Thus, one might then be able to populate their IC-900/901 with a rare frequency band (such as is offered by the UX-19 10m, or UX-129 1200 MHz modules) by using a
more readily available module (such as a 2m UX-29) and a transverter.</p>

Another option allows the module to act as a stand-alone receiver that provides line-level, squelch-gated audio to a user connector.
A simple RS-232 serial interface allows for remote control, or the radio can simply operate on a fixed frequency.  A duplex receiver
is one of the primary use-cases for this option.</p>

A small MCU is used to capture digital information from the base-controller and perform many of the tasks that were dedicated to discrete
logic I.C.s on the original Front Unit design.  This, along with some other design features, greatly reduces the parts count of the
basic PCBA.  The software for this basic function PCBA (designated as a -001 PCBA) is fairly simple and is focused on acquiring
the 10-bit header frame and pulsing the PLL strobe signal after the 20-bit PLL data frame.  The original 4066 switch array was replaced
by 4053 (3P2T) and 74LVC1G3157 (1P2T) IC switches to create a 4P2T analog switch array (which occupies less space than two 4066 I.C.s) to handle the main/sub band selection.  Using the MCU
to capture the header frame allowed a number of components to be elliminated from the design.  To save pins, the ADC on the MCU is
used in concert with a 7-resistor divider to achieve an 8-position device address selection mechanism (only 6 of these positions are used to support the radio modules).</p>

For the "Interposer" option, designated as a -002 PCBA, only a few 0-ohm resistors need be moved to allow the MCU to solely control
the data, clock, and strobe signals feeding the band-module PLL chip.  The software for this option is somewhat more complex as the MCU
now must capture the PLL data as well, and then process the data to calculate the actual PLL data frame which is then sent to the
band-module PLL chip.</p>

For the "Stand-alone RX" option, designated as a -003 PCBA, there are a number of component changes needed.  Several parts are elliminated,
And more are added to allow the -003 to control the band-module PLL and provide de-emphisized audio to an interface connector (J4).
The removed parts are those that would be used to connect to a base-controller such as that provided my the IC-900 or IC-901.
The de-emphasis and squelch circuit is borrowed from the ACC FC-900 and is very basic.  A digital POT provides squelch and level control
which can be fixed, or adjusted using simple serial commands issued over an RS-232 interface.  An out-board adapter provides the
interface connector and an RS-232 transceiver IC.  This adapter can be installed in the band-module front cover (a DSUB-9 opening must be
cut), or a 3D-printed replacement cover.</p>

The Software link below provides instructions 
to obtain the source code for the various versions of this project.  Links to the tools needed to compile and program 
the <a href="https://www.silabs.com" target="_blank">SiLabs</a> C8051F530 microcontroller used for this project are provided below.</p>
</td>
</tr>
</table>

<center>
<table border="0" width="300">
<tr>
<td>
<font size = "5">
Quick-Links:</p>
<a href = "index.html#hw">Detailed hardware design</a><br>
<a href = "index.html#sw">Detailed software design</a><br>
<a href = "index.html#dlink">Design Links</a></p>
</td>
</tr>
</table>
</center>


<hr size="2" width="100%" align="center">
</div>
<center>
<h2>Hardware Design... <a name = "hw"></a></h2>
<table border="0" width="900">
<tr>
</center>
<td>
<font size = "4">

The C8051F530 is an MCU Iâ€™ve used on several other projects.  This plus its small size made it a good choice for the limited board space offered for this project.
The C8051F531 is the same device minus the "LIN" peripheral (this is an automotive communications protocol, which performs a function similar to J1850 or CAN).
The cost difference (less than a Nickel) isn't worth much time thinking about unless you are buying thousands of the devices.  It has enough timing resources to
perform the edge captures needed for this application, and just enough general purpose I/O (GPIO) pins to get the job done.
</p>

To describe this design, one must first consider the PCBA that it is to replace.  My <a href="../ICOM_Design_Guide.pdf">"ICOM UX Module Design Guide"</a>
discusses the Front Unit logic to a reasonable degree. Here, I have replaced most of the address and control logic circuits (IC3, IC4, IC5, Q8, Q9, part of IC6 and IC7, and
associated discrete components) with the MCU and its associated software.  The 4066 analog switch circuit was somewhat simplified by using a 4053 and a single
analog switch.  This leaves the PLL clock gate and MOD switch logic that was copied, more or less, from the ICOM design.
</p>

IC3 captures the control logic from the base controller.  Six signals are captured by IC3, plus the BUSY signal captured by IC5, but the main/sub signals are actually the same signal, but one is inverted by the base controller software
(this allows the design to save one inverter transistor and a resistor).  The simplified analog switch does not require an inverted version of the switch signal, so
SUB is not needed in the new design.  This leaves only 6 control signals that need to be provided by the MCU.
</p>

Next are the clock and strobe for the PLL.  A single AND gate is used to gate the base controller clock using the STB signal.  This doesn't require any
intervention by the MCU, but it still needs to know the state of the STB and also needs the clock signal.  So, this means that STB, CK, and DATA must be provided to the MCU.
The MCU must also provide the PLL strobe (PSTB) which gates date into the PLL chip.  To support the interposer option, the MCU must provide a separate clock and data signal.
These are routed with 0-ohm resistors so that one path or the other can be supported based on which resistors are installed or not. Thus, 6 GPIO pins are needed for the
serial data services.
</p>

To support the stand-alone RX option, a digital POT was needed.  I chose an SPI type so that the same serial signals present for the PLL can also be used to control the POT, with only the addition of
a /CS signal from the MCU.  I chose to use the MCU ADC to capture one of 8 jumper states to set the device address (the ICOM design captures 7 states).  Finally, two
GPIO pins are used for the UART to allow the stand-alone device to be remotely controlled or confingured. This covers the 16 GPIO pins available on the F530 series
and allows the MCU to fully control all aspects of the UX module interface under any of at least three build options.
</p>

</td>
</tr>
</table>
<center>
<a href="uxffschem.pdf"><img width="617" height="463" src="./uxffschem.jpg"></a>
</p>
<h3>UX FFront Unit Schematic</h3>
<h4>(click on image to see a pdf version)</h4>
</center>
<hr size="2" width="100%" align="center">

</div>
<center>
<h2>Software Design... <a name = "sw"></a></h2>
<table border="0" width="900">
<tr>
</center>
<td>
<font size = "4">

The basic option (-001) software application level operates in a single, empty loop - all of the processing happens inside interrupt service routines (ISRs).  Prior to this loop,
the software initializes the MCU and registers.
</p> 
The ISRs are comprised of one timer interrupt (Timer 0), and one Programmable Counter/timer Array (PCA) interrupt.  Timer 0 provides microsecond level pulse control for the
PLL strobe signal.  The PCA ISR services two GPIOs, one for the main clock input from the base controller, and one for the strobe signal from the base controller.  The clock portion of the PCA ISR
also features a compile-time directive to cover the build-option for the interposer.  In either case, the code shifts the data into an internal register.  This "bit-bang" architecture
was chosen to allow greater flexibility when shifting data due to the fact that the ICOM protocol operates on bit field sizes that are not a multiple of 8 bits.  This also leaves open
options to address the various build options for this project.
</p>
The second PCA GPIO is the strobe input, and this is used to either process the control data (transferring it to the GPIO pins) or pulsing the PSTB signal to latch the PLL data.  For the
interposer option, the PSTB operation would be replaced by a signal to the main application to calculate a new PLL data frame, clock it into the PLL, and then pulse the PSTB signal.
</p>
For the Stand-alone option, the code is rather different.  For this configuration, the requirement is for a simple, single-frequency RX. The main() application sets the control
discretes, the DPOTs, and sends
the PLL data for the desired frequency.  The main-loop then polls for serial commands (with a UART ISR as an additional software element) that modify the existing settings or initiate
storing these settings to non-volatile FLASH memory on the MCU. Since the FLASH memory is only eraseable by sector (512 bytes for this MCU), the system "walks" new data stores through
the entire sector before requiring an erase operation (the software only accesses the last valid entry).  Erases must be initiated by an operator, they are not automatic.
</p>
Some UX modules only require one PLL register access to set the operating frequency, but there are several models that require 2 or more accesses (the UX-129 requires 4).  To accomodate
this variation, the stored data allows up to 5 PLL register values to be stored.  These are sent in order from first to last when the module is reset.  There is also a command for
reading the configuration data.  This is primarily for verification and debug purposes.  An <a href="pllcalc.xlsx">Excel spreadsheet</a> is provided to allow the user to determine the
desired PLL data for a given frequency/band combination.
</p>
Because the Stand-Alone RX configuration requires a connector, a <a href="uxcover.zip">replacement cover</a> was designed with 3D modeling software.  This allows a connector to be installed at the front of the
module without modifying the original cover (the original cover and front unit PCB are then stored together, prefereably somewhere that they can later be located with ease).  The model was
created with OpenSCAD <a href="http://www.openscad.org/" target="_blank">(www.openscad.org)</a>.  I was reluctant to try a text-based shaped description language, but I gained a high degree of functional
literacy after only a few hours.  The <a href="http://www.tridimake.com/2014/09/how-to-use-openscad-tricks-and-tips-to.html" target="_blank">toutorial by Jeremie Francois</a> was very helpful (I've only
finished 1 out of 5 of his chapters).  It's free, so I don't get any kickbacks from referrals...
</p>
<img width="1026" height="330" src="3dcover.png">
</p>
</br>
The <i><a href="../Orion/silabspgm.pdf">"SiLabs Programming guide"</a></i> describes 
the steps and items needed to program the project MCU.  The <a href="uxffsource.html">source code page</a> provides access to the object code for the various SW modes, and describes where and how
to access the source repo.
</p>

</td>
</tr>
</table>

<hr size="2" width="100%" align="center">
</div>

<center>
<h2>Finis... <a name = "hm133"></a></h2>
</p>
<table border="0" width="900">
<tr>
</center>

<td>
<font size = "4">
Admittedly, this project has a limited audience.  However, there are a lot of ICOM UX modules out there, and I would venture to
debate that many are in a box gathering dust for lack of a better use.  Using the UX FFront Unit to re-purpose these modules could
bring some interesting usefulness to these old workhorse radios.
</p>
Here is a listing of the various project documents that are directly relevant to the UX FFront Unit Project:
</p>
</td>
</tr>
</table>

<table border="0" width="350">
<tr>
<td>
<font size = "4">
<a href="uxffsource.html">UX FFront Unit Source Code Page</a> <a name = "dlink"></a></h2><br>
<a href="../Orion/silabspgm.pdf">SiLabs MCU Programming guide</a> <br>
<a href="pllcalc.xlsx">pllcalc.xlsx, Excel PLL Calculator spreadsheet</a>
<a href="uxffmanual.pdf">Project Assembly and Operations Manual</a> <br>
<a href="uxffschem.pdf">UX FFront Unit Schematic</a> <br>
<a href="uxffdsn.zip">UX FFront Unit Design (Protel99 SE)</a> <br>
<a href="uxffgerbers.zip">UX FFront Unit PCB Gerber Files</a> <br>
<a href="uxcover.zip">3D model, ICOM UX replacement cover</a>
<a href="../ICOM_Design_Guide.pdf">"ICOM UX Module Design Guide"</a></p>
</td>
</tr>
</table>

<hr size="2" width="100%" align="center">
</div>


<p class="MsoNormal" style="mso-margin-top-alt:auto;mso-margin-bottom-alt:auto"><o:p>&nbsp;</o:p></p>

</div>




</body></html>
